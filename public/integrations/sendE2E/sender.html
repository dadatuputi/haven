<!--////////////////////////////////////////////////////////////////////////////
// Copyright Â© 2022 xx foundation                                             //
//                                                                            //
// Use of this source code is governed by a license that can be found in the  //
// LICENSE file.                                                              //
/////////////////////////////////////////////////////////////////////////////-->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Sender</title>

	<link rel="stylesheet" type="text/css" href="../assets/styles.css">
	<link rel="shortcut icon" type="image/x-icon" href="sender.ico"/>

	<script type="text/javascript" src="sendE2e.js"></script>
	<script type="text/javascript" src="../assets/utils.js"></script>
	<script type="text/javascript" src="../assets/wasm_exec.js"></script>
	<script>
        const go = new Go();
        const binPath = '../assets/xxdk.wasm'
        WebAssembly.instantiateStreaming(fetch(binPath), go.importObject).then((result) => {
            go.run(result.instance);

            // Set log level
            LogLevel(0);

            // Output log to file that can be downloaded using a button
            const logFile = LogToFile(0, "sender.log", 5000000);
            document.getElementById('logFileDownload').addEventListener(
                'click', () => download(logFile.Name(), logFile.GetFile()))

            // Get element to print log messages to
            const logOutput = document.getElementById("logOutput")
            const htmlConsole = newHtmlConsole(logOutput)

            // Get button that will stop the network follower
            const stopNetworkFollowerBtn = document.getElementById("stopNetworkFollowerBtn")

            // Client specific parameters
            const recipientContactFile = '<xxc(2)koEeDIK9TadI5PmUbZxKA5SPwuH+6WdUNiy9q2z0hrADkAZiB9kZo+Dl3buUQeBSieIP645WSDWyzxqi5HgGawVEufOOU3sDCINTsNv7DS5IvwUly2IM2kZp2LufmAD/kvUQ5xILfwR6PR256OTMjEJNRyNxCXit/Mot5sCQMIUSZ3OUa6xDxMRAfVKNAK6Htv6/JUa/sGu2CFjl7GL7pr3agmpVE5w00bZoW1dKurlSubs6PVTFQv3VBwf7GxSIolbuF5+DlFVU6R2ficxTG8ejuijdEK2lmlCaEDm8kVURVywTH3sytyf2eJaIW1tU1pNPkdPvgyCobk/FVmzKPQdbpnEFShSsUDVRebVvuPooV62yCZlJ5sSKWJg1WmvLSAb7uwMXl4zPkltZbF442OsxiQqikmAsO9wNQ6SH22bfgO8+MGR3i3L3oH6P6Z5Zx+hnqkDGUj0KbLxVdlhpcYACf+Uf3XOiq8ZvymfES8SCE+RfxjuNRLxzzNpVqUFrC1tmYRTOAO+k2oKDU9nP5gxKSQI5cCEFtGRGjrdsqsIEh3mX/y7WDgU0bQAAAgA7cQUCKI3GajkCZv68aRVbOw==xxc>';
            const myContactFileName = '';
            const statePath = 'statePathSender';
            const statePass = 'password';

            document.getElementById('ndfInput').addEventListener('change', e => {
                let reader = new FileReader();
                reader.onload = async function (e) {
                    try {
                        await SendE2e(htmlConsole, stopNetworkFollowerBtn,
                            e.target.result, recipientContactFile,
                            myContactFileName, statePath, statePass);
                    } catch (e) {
                        htmlConsole.error(e)
                    }
                };
                reader.readAsText(e.target.files[0]);
            }, false);
        });
	</script>
</head>
<body>
<h1 style="margin-top: 0">SendE2E: Sender</h1>
<div class="toolbar">
	<input type="button" value="Clear localStorage" onclick="localStorage.clear();">
	<input type="button" value="Download Log File" id="logFileDownload">
	<input type="button" value="Stop Network Follower" id="stopNetworkFollowerBtn" style="display:none;" >
</div>
<p>Selecting an NDF will start the client.</p>
<form id="startCmix">
	<div>
		<label for="ndfInput">Select NDF file to use <code>ndf</code> variable in JS:</label><br/>
		<input type="file" id="ndfInput" required/>
	</div>
	<div>
		<label for="messageInput">Your Message</label><br/>
		<input type="text" id="messageInput"/>
		<input type="button" id="messageSend" value="send"/>
	</div>

</form>
<div id="logOutput" class="htmlOutput"></div>
</body>
</html>