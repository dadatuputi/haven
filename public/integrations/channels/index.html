<!--////////////////////////////////////////////////////////////////////////////
// Copyright Â© 2022 xx foundation                                             //
//                                                                            //
// Use of this source code is governed by a license that can be found in the  //
// LICENSE file.                                                              //
/////////////////////////////////////////////////////////////////////////////-->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>The Internet Speakeasy Client</title>

        <link href="../assets/styles.css" rel="stylesheet" type="text/css">
        <link href="favicon.ico" rel="icon" type="image/x-icon">


        <script src="channels.js" type="text/javascript"></script>
        <script src="../assets/utils.js" type="text/javascript"></script>
        <script src="../assets/wasm_exec.js" type="text/javascript"></script>
        <script src="../assets/ndf.js" type="text/javascript"></script>
        <script>
        const go = new Go();
        const binPath = '../assets/xxdk.wasm'
        WebAssembly.instantiateStreaming(fetch(binPath), go.importObject).then((result) => {
            go.run(result.instance);

            // Set log level
            //LogLevel(0);

            // Output log to file that can be downloaded using a button
            const logFile = LogToFile(0, "receiver.log", 5000000);
            document.getElementById('logFileDownload').addEventListener(
                'click', () => download(logFile.Name(), logFile.GetFile()))

            // Get element to print log messages to
            const logOutput = document.getElementById("logOutput")
            const htmlConsole = newHtmlConsole(logOutput)
            const messageOutput = document.getElementById("messageOutput")
            const messageConsole = newHtmlConsole(messageOutput)

            // Get button that will stop the network follower
            const stopNetworkFollowerBtn = document.getElementById("stopNetworkFollowerBtn")

            // Client specific parameters
            const statePath = 'channelPath';
            const statePass = 'password';

            // document.getElementById('ndfInput').addEventListener('change', e => {
            //     let reader = new FileReader();
            //     reader.onload = async function (e) {
            //         try {
            //             await Channels(htmlConsole, messageConsole, stopNetworkFollowerBtn,
            //                 e.target.result, statePath, statePass);
            //         } catch (e) {
            //             htmlConsole.error(e)
            //         }
            //     };
            //     reader.readAsText(e.target.files[0]);
            // }, false);

            document.getElementById('startNetwork').addEventListener('click', async e => {
                try {
                    await Channels(htmlConsole, messageConsole, stopNetworkFollowerBtn,
                        ndf, statePath, statePass);
                } catch (e) {
                    htmlConsole.error(e)
                }
            }, false);

        });
	</script>
</head>
<body>
<h1 style="margin-top: 0">The Internet Speakeasy Client</h1>
<div class="toolbar">
	<input type="button" value="Clear localStorage" onclick="localStorage.clear();">
	<input type="button" value="Download Log File" id="logFileDownload">
	<input type="button" value="Stop Network Follower" id="stopNetworkFollowerBtn" style="display:none;" >
</div>
<form id="startCmix">
<!--	<div>
		<label for="ndfInput">Select NDF file to use <code>ndf</code> variable in JS:</label><br/>
		<input type="file" id="ndfInput" required/>
	</div>-->
	<div>
		<p>Click on the button below to connect to the network and start the client.</p>
		<input type="button" id="startNetwork" value="Connect to Network"/>
	</div>
</form>
<form id="makeChannel">
	<div>
		<label for="username1">Username</label><br/>
		<input type="text" id="username1" disabled/>
	</div>
	<div>
		<label for="chanName">Speakeasy Name</label><br/>
		<input type="text" id="chanName" required disabled/>
	</div>
	<div>
		<label for="chanDescription">Speakeasy Description</label><br/>
		<input type="text" id="chanDescription" required disabled/>
	</div>
	<input type="button" value="Make Speakeasy" id="makeChannelSubmit" disabled />
</form>
<form id="joinChannel">
	<div>
		<label for="username2">Username</label><br/>
		<input type="text" id="username2" disabled/>
	</div>
	<div>
		<label for="prettyPrintInput">Speakeasy to Join</label><br/>
		<input type="text" id="prettyPrintInput" required disabled/>
		<input type="button" value="Join Speakeasy" id="joinChannelSubmit" disabled/>
	</div>
</form>
<form id="channelInfo">
<div>
	<label for="chanNameOutput">Speakeasy Name</label><br/>
	<input type="text" id="chanNameOutput" disabled/>
</div>
<div>
	<label for="chanDescriptionOutput">Speakeasy Description</label><br/>
	<input type="text" id="chanDescriptionOutput" disabled/>
</div>
<div>
	<label for="chanIdOutput">Speakeasy ID</label><br/>
	<input type="text" id="chanIdOutput" disabled/>
</div>
<div>
	<label for="prettyPrintOutput">Speakeasy Share</label><br/>
	<input type="text" id="prettyPrintOutput" disabled/>
</div>
</form>
<div>
	<label for="message" id="messageLabel">Message to Send</label><br/>
	<input type="text" id="message" required disabled/>
	<input type="button" value="Send" id="sendMessageSubmit" disabled/>
</div>
<div id="messageOutput" class="htmlOutput"></div>
<div id="logOutput" class="htmlOutput"></div>
</body>
</html 
    </head>
</html> 
    </head>
</html> 
    </head>
</html>
    </head>
</html>>